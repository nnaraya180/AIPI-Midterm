# Posture Coach — Midterm Project
### AIPI 590 | n_neil_midterm_project

---

## Purpose

The goal of this project is to build a wearable posture coaching device that uses
10 IMU sensors (MPU6050) attached to different body segments to classify posture
in real time. The device predicts whether a person's posture is good or bad in the
context of sitting or standing, then provides physical feedback via a buzzer and
displays results on a 16x2 LCD screen.

The longer term vision for this project (final project) is to identify which muscle
groups are weak based on posture patterns and suggest corrective exercises.

---

## Hardware

| Component | Details |
|---|---|
| Raspberry Pi | Main compute platform |
| 10x MPU6050 IMUs | Pitch and roll angle sensors |
| TCA9548A Multiplexer | Handles 8 IMUs on channels 0–7 |
| 2x Direct IMUs | Connected at I2C addresses 0x68 and 0x69 |
| Active Buzzer | GPIO 18 — audio feedback |
| 16x2 I2C LCD | I2C address 39 (decimal) — display |
| Navigate Button | GPIO 27 — cycles menu cursor |
| Select Button | GPIO 22 — confirms selection / exits continuous mode |

### IMU Placement

| Segment | Connection |
|---|---|
| Left thigh | TCA channel 0 |
| Left calf | TCA channel 1 |
| Right calf | TCA channel 2 |
| Right thigh | TCA channel 3 |
| Upper mid back | TCA channel 4 |
| Upper back | TCA channel 5 |
| Right shoulder | TCA channel 6 |
| Left shoulder | TCA channel 7 |
| Lower mid back | Direct I2C 0x68 |
| Lower back | Direct I2C 0x69 |

### Note on Flex Sensors
Two flex sensors were explored as additional inputs but were dropped due to
inconsistent readings that were not reliable enough to include in the model.

---

## Project Structure

```
n_neil_midterm_project/
│
├── imu_reader.py         # Utility — reads all 10 IMUs, returns pitch/roll dict
├── data_collection.py    # Step 1 — collect labeled posture data to CSV (run on Pi)
├── train_model.py        # Step 2 — train Random Forest model (run on laptop)
├── inference.py          # Step 3 — live inference with LCD menu (run on Pi)
│
├── posture_data.csv      # Collected training data (generated by data_collection.py)
├── model_package.joblib  # Trained model package (generated by train_model.py)
│
└── README.md
```

---

## How to Run

### Dependencies
Install the following on the Raspberry Pi:
```
pip install adafruit-circuitpython-mpu6050
pip install smbus2
pip install gpiozero
pip install lcd-i2c
pip install joblib
pip install pandas
pip install scikit-learn
```

Install the following on your laptop (for training only):
```
pip install pandas scikit-learn joblib
```

---

### Step 1 — Collect Data (Raspberry Pi)

```
python data_collection.py
```

- Option 1: Initialize sensors
- Options 2–5: Capture each of the 4 posture labels
- Hold each posture for the full 30 second capture window
- Repeat each label multiple times across different sessions for a robust dataset
- Data is saved to `posture_data.csv`

**Labels collected:**
- `sitting_good`
- `sitting_bad`
- `standing_good`
- `standing_bad`

**Important:** Mount each IMU in a consistent orientation every session.
The model learns your specific mounting angles — consistency matters more than perfection.

---

### Step 2 — Train Model (Laptop)

Copy `posture_data.csv` from the Pi to your laptop, then:

```
python train_model.py
```

Run options 1 through 7 in order:
1. Load data
2. Encode labels
3. Train/test split
4. Train Random Forest
5. Evaluate model — review accuracy and per-label breakdown
6. Print feature importances — shows which body segments matter most
7. Save model package → writes `model_package.joblib`

Copy `model_package.joblib` back to the Pi before running inference.

---

### Step 3 — Live Inference (Raspberry Pi)

```
python inference.py
```

The script initializes hardware and loads the model automatically on startup,
then shows the physical LCD menu:

```
> A: Check Now
  B: Continuous
```

- **Navigate button (GPIO 27):** move cursor between A and B
- **Select button (GPIO 22):** confirm selection

**Check Now mode:** takes a single snapshot, beeps twice for good posture, once for bad.

**Continuous mode:** monitors posture every second, beeps once when bad posture is
detected with a 60 second cooldown between alerts. Press the select button to stop
and return to the menu.

---

## ML Model

**Model:** Random Forest Classifier (`sklearn.ensemble.RandomForestClassifier`)
- 100 decision trees (`n_estimators=100`)
- Each tree trained on a random subset of samples and features
- Final prediction is a majority vote across all 100 trees

**Features:** Pitch and roll angles from all 10 IMUs = 20 features per sample

**Labels:** `sitting_good`, `sitting_bad`, `standing_good`, `standing_bad`

**Why Random Forest over Decision Tree:**
A single Decision Tree tends to overfit on small, noisy datasets like this one.
Random Forest is more robust to IMU noise and slight variation in sensor placement
between sessions. It also provides `feature_importances_` which shows which body
segments are most predictive — useful for the final project's muscle weakness analysis.

**Training/test split:** 80/20, `random_state=42`

**Model package contents saved to `model_package.joblib`:**
- `model` — trained RandomForestClassifier
- `feature_cols` — ordered list of feature column names
- `encoder` — LabelEncoder to decode numeric predictions back to label strings

---

## Sources

- DataCamp — Random Forests Classifier in Python:
  https://www.datacamp.com/tutorial/random-forests-classifier-python

- Adafruit MPU6050 CircuitPython library:
  https://github.com/adafruit/Adafruit_CircuitPython_MPU6050

- ISO/IEC 30141 IoT Reference Architecture (provided in course materials)

- AI Assistance: Claude (Anthropic) was used as a coding partner to help troubleshoot
  code. Clause was also used to write this read me. Most code was taken from class lab exercises. 
